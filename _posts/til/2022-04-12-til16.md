---

title:  "220412 Today I Learned"
categories: 'til'
---
<!-- 
![aas](/assets/til/220328til1.png)

<img src="/assets/til/220328til1.png" width="100%" height="100%"> -->



### ì¼ì§€

ë¯¸ë‹ˆí”„ë¡œì íŠ¸ ë¦¬ë·°ê°€ì¦ˆì•„ã…ã…      

ì‚¬ì‹¤ ë‚´ê°€ í•  ìˆ˜ ìˆëŠ”ê²ƒì€ ê·¸ë ‡ê²Œ ë§ì§€ ì•Šì€ë°,  
ê¸°ëŒ€ì¹˜ë¥¼ ë†’ì—¬ë‘ê³ , ê·¸ì—ë§ê²Œ ìˆ˜í–‰í•˜ê³ ,    
ê·¸ë¡œì¸í•´ ë‹¤ì‹œí•œë²ˆ ê¸°ëŒ€ì¹˜ê°€ ë†’ì•„ì§€ê³ , ê·¸ì—ë§ê²Œ ìˆ˜í–‰í•˜ê³ ,      

ì–¸ì  ê°€ëŠ” í„°ì§€ê² ì§€. ê·¸ë•Œê¹Œì§„ ì—´ì‹¬íˆí•˜ì.   


### ì˜¤ëŠ˜ì˜ í• ì¼

- [x] 220412 TIL ì‘ì„±    
- [x] Ansible ê³µë¶€ìë£Œì°¾ê¸°
- [x] ì‹¤ìŠµ ì§„í–‰ì‚¬í•­ ë³µê¸°
- [x] yaml ê³µë¶€?

**ì£¼ìš” í‚¤ì›Œë“œ**

Ansible Architecture  
inventory

### ì¶”ê°€ë¡œ ì •ë¦¬í•´ì•¼í•  ë¶€ë¶„




### ìˆ˜ì—… ì •ë¦¬


- Ansible ì•„í‚¤í…ì³ êµ¬ì„± ë‚´ìš©
    - ì‹œìŠ¤í…œ ìœ í˜•ìœ¼ë¡œ ì»¨íŠ¸ë¡¤ ë¨¸ì‹ ê³¼ ê´€ë¦¬ ë…¸ë“œê°€ ìˆìŒ
    - ì»¨íŠ¸ë¡¤ ë¡œë“œì— Ansibleì´ ì„¤ì¹˜ë˜ë©°, ê´€ë¦¬ ë…¸ë“œë“¤ì€ ì»¨íŠ¸ë¡¤ ë¨¸ì‹ ì— ì˜í•´ ìœ ì§€ë˜ê±°ë‚˜ ê´€ë¦¬ë¨
    - ê´€ë¦¬ ë…¸ë“œë“¤ì€ ì¸ë²¤í† ë¦¬ íŒŒì¼ì— ë‚˜ì—´ë˜ì–´ì•¼ í•˜ë©°, ì—¬ê¸°ì—ëŠ” í˜¸ìŠ¤íŠ¸ì´ë¦„ ë˜ëŠ” IP ì£¼ì†Œë¡œ ì €ì¥
    - ì¸ë²¤í† ë¦¬ì— ê° ê´€ë¦¬ ë…¸ë“œë“¤ì˜ ê¸°ëŠ¥ë³„ë¡œ ê·¸ë£¹í™” ì‹œì¼œì„œ ì €ì¥ë„ ê°€ëŠ¥
    - ì‹œìŠ¤í…œ ê´€ë¦¬ìëŠ” ì»¨íŠ¸ë¡¤ ë¡œë“œì— ë¡œê·¸ì¸í•˜ì—¬ í”Œë ˆì´ë¶ ë˜ëŠ” ì›ê²© ì „ì†¡ ëª…ë ¹ì„ ì‚¬ìš©í•˜ì—¬ ê´€ë¦¬ ë…¸ë“œë¥¼ ì œì–´í•  ìˆ˜ ìˆê³ , ì´ ë•Œ ì¸ë²¤í† ë¦¬ì— ì €ì¥ëœ ê´€ë¦¬ ë…¸ë“œë“¤ì„ íŒ¨í„´ í˜•ì‹ìœ¼ë¡œ ì§€ì •í•˜ì—¬ ì œì–´í•  ìˆ˜ ìˆìŒ
    - ì»¨íŠ¸ë¡¤ ë¡œë“œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ SSHë¥¼ ì‚¬ìš©í•˜ì—¬ ê´€ë¦¬ ë…¸ë“œì™€ í†µì‹ 
    - í”Œë ˆì´ë¶ì—ì„œ ì°¸ì¡°í•œ ëª¨ë“ˆì€ ê´€ë¦¬ ë…¸ë“œì— ë³µì‚¬ë˜ë©°, ê´€ë¦¬ ë…¸ë“œì—ì„œ ì‹¤í–‰
    - ì‚¬ìš©ë˜ëŠ” ëª¨ë“ˆì˜ ì¢…ë¥˜ë¡œëŠ” ì½”ì–´(core) ëª¨ë“ˆê³¼, ì‚¬ìš©ì ì§€ì • ëª¨ë“ˆ ë“±

- Ansible êµ¬ì„± íŒŒì¼
    - Ansibleì˜ ì‘ë™ ë°©ì‹ì„ êµ¬ì„±í•˜ëŠ” íŒŒì¼
    - ì¸ë²¤í† ë¦¬ íŒŒì¼ì˜ ìœ„ì¹˜, ê´€ë¦¬ ë…¸ë“œì— ì—°ê²°í•˜ëŠ” ë°©ë²•, ì—°ê²° í•œ í›„ ì‘ë™ ë°©ë²• ë“± ë¬´ìˆ˜íˆ ë§ì€ êµ¬ì„±ì„ ì§€ì •í•  ìˆ˜ ìˆìŒ
    - ê¸°ë³¸ Ansible êµ¬ì„± íŒŒì¼ì˜ ìœ„ì¹˜ëŠ” /etc/ansible/ansible.cfg
    - Ansible êµ¬ì„± íŒŒì¼ ìš°ì„  ìˆœìœ„
        1. ANSIBLE_CONFIG í™˜ê²½ ë³€ìˆ˜
        2. í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ ansible.cfg
        3. í™ˆ ë””ë ‰í† ë¦¬ì˜ ~/.ansible.cfg
        4. /etc/ansible/ansible.cfg
    -  ìš°ì„  ìˆœìœ„ê°€ ë†’ì€ íŒŒì¼ì— ì •ì˜ëœ ê°’ì´ ì´ì „ ì •ì˜ëœ ê°’ë³´ë‹¤ ìš°ì„ í•¨

- Ansible ì‘ë™ ë°©ì‹ ì œì–´ ìš°ì„  ìˆœìœ„
    - Ansible ì‘ë™ ë°©ì‹ì„ ì œì–´í•˜ê¸° ìœ„í•´ Ansible êµ¬ì„± íŒŒì¼ ì™¸ì—ë„ ansible ëª…ë ¹ì˜ ì˜µì…˜, í”Œë ˆì´ë¶ í‚¤ì›Œë“œ, ë³€ìˆ˜ë¥¼ ì´ìš©í•´ ë™ì‘ì„ ì œì–´í•  ìˆ˜ ìˆìŒ
        1. -e ì˜µì…˜ì— ì§€ì •í•œ ë³€ìˆ˜
        2. ë³€ìˆ˜
        3. í”Œë ˆì´ë¶ í‚¤ì›Œë“œ
        4. ëª…ë ¹ì˜ ì˜µì…˜
        5. Ansible êµ¬ì„± íŒŒì¼

- ì¸ë²¤í† ë¦¬
    - Ansibleì€ ì¸í”„ë¼ì— ì¡´ì¬í•˜ëŠ” ì—¬ëŸ¬ í˜¸ìŠ¤íŠ¸ë¥¼ ê´€ë¦¬í•¨
    - í˜¸ìŠ¤íŠ¸ì˜ ëª©ë¡ ë˜ëŠ” ê·¸ë£¹ì„ ì§€ì •í•œ ì¸ë²¤í† ë¦¬ íŒŒì¼ì´ í•„ìš”í•˜ë©° ì¸ë²¤í† ë¦¬ê°€ ì •ì˜ë˜ë©´ íŒ¨í„´ì„ ì‚¬ìš©í•˜ì—¬ Ansibleì„ ì‹¤í–‰í•  ë…¸ë“œ ë˜ëŠ” ê·¸ë£¹ì„ ì„ íƒí•¨
    - ê¸°ë³¸ ì¸ë²¤í† ë¦¬ íŒŒì¼ì€ /etc/ansible/hosts ì´ë©°, -i ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ë¥¸ ì¸ë²¤í† ë¦¬ íŒŒì¼ì„ ì§€ì •í•  ìˆ˜ ìˆìŒ
    - ì¸ë²¤í† ë¦¬ íŒŒì¼ì€ ì¼ë°˜ì ìœ¼ë¡œ INI íŒŒì¼ í˜•ì‹ì„ ê°€ì§€ê³  ìˆìœ¼ë©°, YAML í˜•ì‹ìœ¼ë¡œ ì§€ì •í•  ìˆ˜ ìˆìŒ

- ì •ì  ì¸ë²¤í† ë¦¬
    - ì‚¬ìš©ìê°€ ì§ì ‘ INI ë˜ëŠ” YAML í˜•ì‹ìœ¼ë¡œ íŒŒì¼ì„ ì§ì ‘ ì‘ì„±
- ê¸°ë³¸ ê·¸ë£¹
    - all : ëª¨ë“  í˜¸ìŠ¤íŠ¸ í¬í•¨
    - ungrouped : ê·¸ë£¹ì— ì†í•˜ì§€ ì•Šì€ ëª¨ë“  í˜¸ìŠ¤íŠ¸ í¬í•¨
- ì—¬ëŸ¬ ê·¸ë£¹ì— ì†í•œ í˜¸ìŠ¤íŠ¸
    - ê° í˜¸ìŠ¤íŠ¸ëŠ” í•˜ë‚˜ ì´ìƒì˜ ê·¸ë£¹ì— ì†í•  ìˆ˜ ìˆìŒ
    - ì¤‘ì²© ê·¸ë£¹ì„ ì´ìš©í•œ ì¸ë²¤í† ë¦¬ ë‹¨ìˆœí™”

- ë™ì  ì¸ë²¤í† ë¦¬
    - ê°€ìƒí™”, í´ë¼ìš°ë“œ ë° ì»¨í…Œì´ë„ˆ í™˜ê²½ê³¼ ê°™ì´ ì‹œê°„ì´ ì§€ë‚¨ì— ë”°ë¼ ê´€ë¦¬ ë…¸ë“œì˜ ë³€í™”ê°€ ë§ì€ ê²½ìš°ì— ì‚¬ìš©
    - í´ë¼ìš°ë“œ ê³µê¸‰ì, LDAP ë° CMDB ë“± ë™ì  ì™¸ë¶€ ì¸ë²¤í† ë¦¬ ì‹œìŠ¤í…œì—ì„œ í˜¸ìŠ¤íŠ¸ì˜ ëª©ë¡ì„ ë™ì ìœ¼ë¡œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ
- ì—°ê²° ë°©ë²•
    - ì¸ë²¤í† ë¦¬ í”ŒëŸ¬ê·¸ì¸
    - ì¸ë²¤í† ë¦¬ ìŠ¤í¬ë¦½íŠ¸
    - AWS ì—ì„œ ì—°ê²°ë°©ë²•ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” íŒŒì´ì¬ìš© AWS SDK boto íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì•¼ í•¨.
- ì¸ë²¤í† ë¦¬ í™•ì¸
    - ansible ë˜ëŠ” ansible-inventory ëª…ë ¹ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŒ
    - ê¸°ë³¸ ì¸ë²¤í† ë¦¬ íŒŒì¼ì´ ì•„ë‹Œ ê²½ìš° -i ë˜ëŠ” --inventory ì˜µì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ

- íŒ¨í„´
    - Ad-hoc ëª…ë ¹ ë˜ëŠ” í”Œë ˆì´ë¶ì„ ì‹¤í–‰í•  ë•Œ ì‘ì—…ì„ ì‹¤í–‰í•  ê´€ë¦¬ ë…¸ë“œ ë˜ëŠ” ê·¸ë£¹ì„ ì§€ì •í•  ë•Œ íŒ¨í„´ì„ ì´ìš©í•´ ê´€ë¦¬ ë…¸ë“œë¥¼ ì„ íƒ
    - íŒ¨í„´ì€ ë‹¨ì¼ í˜¸ìŠ¤íŠ¸, IP ì£¼ì†Œ, ì¸ë²¤í† ë¦¬ ê·¸ë£¹ì„ ì°¸ì¡°í•  ìˆ˜ ìˆê³ , ì§‘í•©, ì™€ì¼ë“œì¹´ë“œ, ì •ê·œí™” í‘œí˜„ì‹ ë“± ì‚¬ìš©ì´ ê°€ëŠ¥

- ëª¨ë“ˆ
    - ëª¨ë“ˆì€ Ansibleì„ ì´ìš©í•´ ê´€ë¦¬ ë…¸ë“œì— ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ” í•µì‹¬ ìš”ì†Œ
    - ëª¨ë“ˆì€ Python ì½”ë“œë¡œ ì´ë£¨ì–´ì ¸ ìˆìœ¼ë©°, /usr/lib/python3/dist-packages/ansible ê²½ë¡œì— ìˆìŒ.
    - ansible-doc ëª…ë ¹ì„ ì´ìš©í•´ ëª¨ë“ˆì˜ ëª©ë¡ì„ í™•ì¸í•˜ê³ , ëª¨ë“ˆì˜ ì‚¬ìš©ë²•ì„ í™•ì¸í•  ìˆ˜ ìˆìŒ

- Ad-Hoc ëª…ë ¹
    - í”ŒëŸ¬ê·¸ì¸ í™•ì¸ ëª…ë ¹ì–´
        - Ansible ad-hoc ëª…ë ¹ì€ í•˜ë‚˜ ì´ìƒì˜ ê´€ë¦¬ ë…¸ë“œì— ë‹¨ì¼ ì‘ì—…ì„ ì‹¤í–‰í•˜ëŠ” ì„ì‹œ ëª…ë ¹
        - ì„ì‹œ ëª…ë ¹ì€ ê±°ì˜ ë°˜ë³µí•˜ì§€ ì•ŠëŠ” ê°„ë‹¨í•œ ì‘ì—…ì— ì£¼ë¡œ ì‚¬ìš©



[YAML Tutorial](https://youtu.be/1uFVr15xDGg)

1. Intro


2. YAML is popular

    - Configuration files all written in YAML
    - Widely use format
    - For diff. Devops tools and applications
        - Docker, Kubernetes, Ansible, Prometheus, etc...

3. What is YAML?

    - YAML is a data serialization language, > Like XML, JSON
    - What is a serialization language? Standard format to transfer data

        ```
        YAML Ain't Markup Language
        File extension: .yaml .yml
        ```

4. Why learn YAML? YAML Format compared to XML and JSON

    YAML Format compared to others
    - human readable and intuitive
    
    |YAML|XML|JSON|
    |:---:|:---:|:---:|
    |Line Separation<br>Indentation|Tags<br>Angle bracket|Curly brackets<br>{}|
    
    - Clean, Human Readable form of the 3

    ğŸ’¡ YAML is superset of JSON:
        Any valid JSON file is also a valid YAML file

5. YAML Use Cases   
    Docker compose file, Ansible, Kubernetes, Prometheus    

6. YAML Syntax

    - Spaces(Indetation) should be exactly same for each attributes
    - Indenting well or install a yaml plugin/extension on ur preferred IDE
        
        - Key-Value Pair; Basic cpnt. of YAML
        - Comments; b2w attrb. OR anywhere to make YAML readable, understandable
        - Object; By indenting, individual k-v pair into obj
        - Lists; By using dash-, stay at same level
        - Boolean; value like true or false / yes or no / on or off
        - More of lists; Can put lists in list > list of objects    
                         Can use Square brackets[] like list

7. Real Kubernetes YAML Configuration Example

    - For Real example
    - Example of App containers on k8s
    ![example](/assets/images/til16.png)

8. Multi-line strings
    - File contents ì‘ì„±í• ë•Œ ì‚¬ìš©

    ```yaml
    multilinestring: "rather than using carrage return like this \n"
    multilinestring: |
    "You can use the pipe sign
    to express the contents of the file
    so all of these will be interpreted as multiline inserts"

    mutillinestirng: >
    "those are super long text.
    but it should be written in a one sentence.
    So those 3 lines will be interpreted as one sentence."
    ```
    
9. Environment variables

    - ë§Œì•½ $ì²˜ëŸ¼ íŠ¹ì •í•˜ê²Œ ì •í•´ì§„ ë³€ìˆ˜ ê¸°í˜¸ë¥¼ í™œìš©í•œë‹¤ë©´ pod ì™¸ë¶€ì—ì„œ pod ë‚´ë¶€ë¡œ ì ‘ì†í•˜ëŠ” ì‹ìœ¼ë¡œ ì‚¬ìš©ê°€ëŠ¥
    - inside of YAML file
        - mysql -h 127.0.0.1 -u root -p$MYSQL_ROOT_PASSWORD -e 'SELECT 1'
        - YAMLì—ì„œ í™˜ê²½ë³€ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ”ê²ƒì€ ì˜ì•Œë ¤ì ¸ OR ì˜ì •ë¦¬ë˜ì–´ ìˆì§€ì•ŠìŒ(isn't well documented).

10. Placeholders

    - Instead of directly writing the values,
    - Define placeholder. by double curly brace \{\{\}\}

    ```yaml
    metadata:
      name:  \{\{ .Values.service.name }}
    spec:
      selector:
        app: \{\{  .Values.service.app  }}
      ports:
        - protocol: TCP
          port: \{\{.Values.service.port }}
          targetPort: \{\{ .Values.service.targetport }}
    ```

11. Multiple YAML documents
    - In 1 file, define multiple cpnts
    - Separates by using --- three dashes

12. YAML and JSON in Kubernetes
    - you can use yaml and json     
    - but I(presenter) prefer yaml