---
layout: single
title:  "CKA 응시 팁&설정"
categories: 'cka'
---

### Lab settings

- YAML작성 편하게하는 vi 에디터 설정     
    ```
    $ vi .vimrc

    set et
    set sw=2
    set ts=2
    set nu
    ```
- 자동완성 설정(공식문서)      
    ```
    https://kubernetes.io/ko/docs/tasks/tools/included/optional-kubectl-configs-bash-linux/
    ```
- 시험환경에서, 터미널에 복/붙할때는 `ctrl+shift+c`, `ctrl+shift+v`
- 가능한 yaml작성보다는 선언형(명령어 입력)으로 생성. 시험환경 렉걸림
- 컨텍스트에 항상 주의

### 명령어 예시

- pod 생성시
    - k run {name} --image= ... --dry-run=client -o yaml > pod.yaml
- 리소스 생성시
    - k create 로 생성가능한 리소스를 살펴보고
    - k create {resource} --help로 생성 예제를 확인한 뒤
    - k create {resource} --dry-run=client -o yaml > resource.yaml로 yaml 생성가능 

### [11 vi Tip](https://youtu.be/TlyXfEpFvKI)

1. Backup
    - k run tip1 --image nginx --dry-run=client -o yaml > 1.yaml
    - cp 1.yaml 1.yaml.b

2. Search & Replace (Tip 2&3)
    - / -> Search
    - Shift C > Replace
    - To change container name in a Pod/Deploy
        - k create deploy tip2 -- image nginx --dry-run=client -o yaml > 2.yaml
        - vi 2.yaml
        - /nginx
        - Shift+c > 원하는 이름입력
3. Append Text at the End
    - Shift A
    - Add a Plugin ImagePolicyWebhook in kube-apiserver.yaml
        - vi kube-apiserver.yaml
        - /plugin
        - Shift+a > 입력모드, 커서 제일 오른쪽 끝으로 이동
4. Delete Text From Cursor Till End
    - Shift D
    - Delete a Plugin AlwaysAdmit in k-api.yaml
        - vi kube-apiserver.yaml
        - /Always
        - Shift+D > 입력모드, 커서 제일 오른쪽 끝으로 이동    
5. Indent Single Line
    - >> Shift right
    - << Shift left? or Shift ,
    - Add serviceAccountName: build-robot
        - vi kube-apiserver.yaml
        - /spec 
        - 칸만들고 넣은 후 >>로 여백조절
6. Add line Above or Below
    - o > add line Below
    - O > add line Above
    - Add nodePort: 30007 to svc
        - k create deploy tip7 --image nginx
        - k expose deploy tip7 --name tip7-svc --port80 --target-port 80 --type NodePort --dry-run=client -o yaml > 7.yaml
        - vi 7.yaml
        - 필요한곳에 찾아가서 o 눌러서 입력상태 들어가기
7. Indent Block of Text
    - Shift V
    - Shift > or <
    - .(dot) -> to repeat
    - Add volumes and volumeMounts to a deploy
        - k create deploy tip8 -- image nginx --dry-run=client -o yaml > 8.yaml
        - vi 8.yaml
8. Copy Pastee Block of text
    - Shift V
    - y
    - p
    - Multi Container Pod
9. Comment line or Delete line
    - 0i#
    - dd
    - kube-apiserver disable --allow-privileged 
        - 0i# -> 0(커서 줄앞으로)/i(입력모드전환)/#(주석기호)
10. Save & Quit 
    - :x
    - Add Label env: prod

### [Docs 정리](https://www.youtube.com/watch?v=trnZZN-C524&ab_channel=TTABAE-LEARN)

- kubectl Cheat sheet
- kubectl reference docs
    - pods
    - service
    - controllers
    - volumes
    - Auth
    - Security context
    - Networkpolicies
    - Troubleshooting
    - Deploy

- Domain 별 시험 유형
    - Storage (10%)
        - emptyDir, hostPath, NFS 기반의 PV생성
        - PVC 생성 후 Pod에 볼륨 마운트 하기
    - Troubleshooting (30%)
        - node에서 kubelet 동작 문제 해결
        - node에서 CNI, kube-proxy 동작 문제 해결
        - CPU 부하 많이 차지하는 특정 pod 찾아 기록 또는 log 별도 저장
    - Workloads & Scheduling (15%)
        - 서비스 deploy 후 rolling/rollbacks, scale in/out
        - ConfigMaps/Secrets 생성 후 pod 적용
        - Pod에 liveness, readiness Probe 적용, Cpu/mem limit 설정
    - Cluster Architecture, Installation & Configuration(25%)
        - ETCD Backup/restore
        - API 인증(RBAC) 보안 (Network policy) 설정
        - kubeadm install/upgrade
    - Sevices & Networking (20%)
        - deply/pd 서비스를 위한 ClusterIP/NodePort 설정
        - Ingress 구성
        - nslookup 명령어 사용, pod와 서비스의 DNS 결과를 저장(CoreDNS 이해)
        - node의 CNI(Container N/W Interface plugin) 동작 문제 해결
        

### 기출 내역

- [220818후기](https://blog.naver.com/miff214/222852040837)
    - 13점 문제가 1개 나왔고 Trouble shooting 문제 였습니다. (workder node의 kubelet down)
        - systemctl status docker => systemctl enable --now docker
        - systemctl status kubelet => systemctl enable --now kubelet
    - 7점은 대부분 여러 resource가 연계된 문제들
        - pv, pvc 생성해서 pod에 mount  -> mounts 정보 describe로 확인하기
        - sidecar - multi containers -> sidecar cont. log 확인하기
        - svc생성하고 ingress로 http 설정
        - ETCD save & restore
        - clusteerrole &binding, sa
        - cluster upgrade 문제 ( master만)
        - deloyment의 cont. 에서 container port(name까지) 설정하고,  nodePort로 된 svc의 target port에 설정한 port name으로 expose하기
        - node drain하기
    - 4점은 정말 Easy~
        - taint가 적용되는 않은 node 갯수 count
        - pod schedule 
        - 특정 node에서 pod deploy => nodeselector 설정
        - log grep해서 save
        - CPU사용량이 가장 많은 pod 이름 save
        - deployment replica scaling
        - multi container pod
        - hostPath로 PV 생성
        - storage로 PVC 생성 -> pv, pvc 확인
